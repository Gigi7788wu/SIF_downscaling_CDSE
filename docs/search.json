[
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "",
    "text": "In the following example we will Downscaled (Increase the spatial resolution) of Sun Induced Fluorescence product derived from Sentinel-5p TROPOMI sensor. A full workflow diagram is presented here: XXXXX"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#introduction",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#introduction",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "",
    "text": "In the following example we will Downscaled (Increase the spatial resolution) of Sun Induced Fluorescence product derived from Sentinel-5p TROPOMI sensor. A full workflow diagram is presented here: XXXXX"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#libraries",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#libraries",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Libraries",
    "text": "Libraries\nWe will need the following libraries to run dowscaling processor\n\nimport openeo\nimport rioxarray as rio\n\n\"\"\"\nCurrently there is an issue with openEO back-end that doesnt allow us to upsample datacubes (For more details see [here](https://forum.dataspace.copernicus.eu/t/how-to-spatial-upsampling-when-using-resample-cube-spatial/4358/6)). For this reason we will need some other libraries to process the parameters cube locally, perform a spatial upsample, create a stac catalog and publish the file and catalog on github.\nThis is needed to create a STAC item for the upsampled parameters:\n\"\"\"\nimport pystac\nfrom pystac.extensions.projection import ProjectionExtension\nfrom pystac.extensions.eo import EOExtension\nfrom datetime import datetime\nfrom shapely.geometry import box, mapping\nimport json\nimport subprocess\n\n# For data visualization\nimport xarray as xr\nimport matplotlib.pyplot as plt\nimport xesmf as xe"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#area-of-interest-and-time-period",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#area-of-interest-and-time-period",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Area of Interest and Time Period",
    "text": "Area of Interest and Time Period\nBefore going into the details of the datasets we need to define an area of interest and time period of our analysis. For this example we will focus in the north part of Germany in the period between 2018-06-20 and 2018-06-30.\n\nspatial_extent_prototype = {\n    \"west\": -6.921387,\n    \"east\": -1.889648,\n    \"south\": 37.230328,\n    \"north\": 40.229218,\n}\n\ntemporal_extent_prototype = [\"2023-06-23\", \"2023-06-30\"]"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#connecting-to-cdse-using-openeo",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#connecting-to-cdse-using-openeo",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Connecting to CDSE using openEO",
    "text": "Connecting to CDSE using openEO\nTo connect to the openEO insfrastructure in the CDSE we need to create a connection:\n\nconnection = openeo.connect(\n    \"https://openeofed.dataspace.copernicus.eu/\"\n).authenticate_oidc()\n\nAuthenticated using refresh token.\n\n\nThis will open a tab in the web-browser where the user needs to authenticate using the CDSE credentials. For more details on openEO in CDSE please see: https://dataspace.copernicus.eu/analyse/openeo\nThen we can see the data collections that are available:\n\nconnection.list_collections()"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#variables",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#variables",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Variables",
    "text": "Variables\nFor this tutorial we will use the following datasets/variables:\nTarget:\n\n\n\nVariable name\nCollection\nBand Name\nSpatial resolution\n\n\n\n\nSun-Induced Flourescence\nDong Li SIF\nSIF\n5 km\n\n\n\nCurrently there are two SIF gridded products derived from Sentinel-5p that are availables:\n\nS5P-PAL SIF. This product is generated by the Sentinel-5P Product Algorithm Laboratory (S5P-PAL) and contains modified Copernicus Sentinel data processed by S[&]T. Unfortunately, the current (at least at: 2025-12-01) STAC dissemination only include plain netcdf files and not cloud optimized data format. Currently the Atmosphere Virtual Lab project is working in provided zarr datacubes for the L3 products, including SIF.\nDong LI SIF. This product uses an artificial neural network to retrieve SIF from Sentinel-5p observations. Thanks to Dong Li for provinding us with a gridded example of the product and the stac item necessary to ingest the product in the openEO-CDSE infrastructure. This files can be found in the data directory of the repository.\n\nPredictors:\n\n\n\nTable 1: SIF predictors\n\n\n\n\n\n\n\n\n\n\n\nVariable name\nCollection\nBand Name\nSpatial resolution\n\n\n\n\nLand Surface Temperature\nSENTINEL3_SLSTR_L2_LST\nLST\n1 km\n\n\nTerrestrial Chlorophyll Index\nSENTINEL3_OLCI_L2_LAND\nOTCI\n300 m\n\n\nIntegrated Water Vapour\nSENTINEL3_OLCI_L2_LAND\nIWV\n300 m\n\n\n\n\n\n\n\nCreating openEO datacubes for the variables\n\n# Testing SIF - Dong Li\n\ncube_SIF_original_median = connection.load_stac(\n    \"https://raw.githubusercontent.com/dpabon/SIF_downscaling_CDSE/refs/heads/main/data/SIF_20180629.json\",\n    bands=[\"SIF\"],\n    spatial_extent=spatial_extent_prototype,\n    temporal_extent=temporal_extent_prototype,\n)\n\n\ncube_LST = connection.load_collection(\n    \"SENTINEL3_SLSTR_L2_LST\",\n    spatial_extent=spatial_extent_prototype,\n    temporal_extent=temporal_extent_prototype,\n    bands=[\"LST\"],\n)\n\ncube_LST_qc = connection.load_collection(\n    \"SENTINEL3_SLSTR_L2_LST\",\n    spatial_extent=spatial_extent_prototype,\n    temporal_extent=temporal_extent_prototype,\n    bands=[\"confidence_in\"],\n)\n\nred = connection.load_collection(\n    \"SENTINEL3_OLCI_L2_LAND\",\n    spatial_extent=spatial_extent_prototype,\n    temporal_extent=temporal_extent_prototype,\n    bands=[\"RC681\"],\n)\n\nnir = connection.load_collection(\n    \"SENTINEL3_OLCI_L2_LAND\",\n    spatial_extent=spatial_extent_prototype,\n    temporal_extent=temporal_extent_prototype,\n    bands=[\"RC865\"],\n)\n\ncube_NIRv = ((nir - red) / (nir + red)) * nir\n\ncube_NIRv = cube_NIRv.rename_labels(dimension=\"bands\", target=[\"NIRv\"])\n\ncube_OLCI_qc = connection.load_collection(\n    \"SENTINEL3_OLCI_L2_LAND\",\n    spatial_extent=spatial_extent_prototype,\n    temporal_extent=temporal_extent_prototype,\n    bands=[\"LQSF\"],\n)\n\n\n\nMasking clouds\n\nmask = cube_LST_qc &gt; 5000\n\ncube_LST_masked = cube_LST.mask(mask)\n\n\nmask_olci = cube_OLCI_qc &gt; 10000\n\ncube_NIRv_masked = cube_NIRv.mask(mask_olci)\n\nIf we call one of the cubes we can see the process graph that is created by openEO:\n\ncube_LST_masked"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#reducing-the-time-dimension",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#reducing-the-time-dimension",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Reducing the time dimension",
    "text": "Reducing the time dimension\nFor this analysis we will compute a composite of the area of interest using all the observations during the time period for all the variables except SIF that is already one time step observation.\n\n# cube_SIF_original_median = cube_SIF_original_median.reduce_temporal(reducer=\"median\")\n\n\ncube_LST_median = cube_LST_masked.reduce_temporal(reducer=\"median\")\n\ncube_NIRv_median = cube_NIRv_masked.reduce_temporal(reducer=\"median\")\n\n\ncube_LST_median"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#inspecting-the-variables",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#inspecting-the-variables",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Inspecting the variables",
    "text": "Inspecting the variables\nThen we will inspect the products, for that we need to execute the processors for each cube, save it locally, open and plot.\n\n# cube_SIF_original_median.execute_batch(outputfile=\"data/cube_SIF_median.tif\")\n# cube_LST_median.execute_batch(outputfile=\"data/cube_LST_median.tif\")\n# cube_NIRv_median.execute_batch(outputfile=\"data/cube_NIRv_median.tif\")\n\n\ncube_sif_local = rio.open_rasterio(\n    filename=\"data/cube_SIF_median.tif\", mask_and_scale=True\n)\ncube_lst_local = rio.open_rasterio(filename=\"data/cube_LST_median.tif\")\ncube_nirv_local = rio.open_rasterio(filename=\"data/cube_NIRv_median.tif\")\n\n\nfig, axs = plt.subplots(nrows=3, figsize=(6, 15))\ncube_sif_local.plot(ax=axs[0])\naxs[0].set_title(\"SIF\")\ncube_lst_local.plot(ax=axs[1])\naxs[1].set_title(\"LST\")\ncube_nirv_local.plot(ax=axs[2])\naxs[2].set_title(\"NIRv\")\n\nplt.tight_layout()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nImportant\n\n\n\nThe LST composite looks heavily influenced by the orbits. For sure it can be better…for example Terrascope Sentinel-3 Level 3 Land Surface Temperature daily synthesis product\nOR maybe Sentinel-3 SYN SLSTR bands…"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#spatial-resampling-to-match-the-sif-resolution-product",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#spatial-resampling-to-match-the-sif-resolution-product",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Spatial resampling to match the SIF resolution product",
    "text": "Spatial resampling to match the SIF resolution product\n\ncube_LST_median_low = cube_LST_median.resample_cube_spatial(\n    target=cube_SIF_original_median, method=\"med\"\n)\n\ncube_NIRv_median_low = cube_NIRv_median.resample_cube_spatial(\n    target=cube_SIF_original_median, method=\"med\"\n)\n\nMerging all the cubes at low resolution (SIF original resolution)\n\ndataset_SIF_low = cube_SIF_original_median.merge_cubes(cube_LST_median_low)\n\ndataset_SIF_low = dataset_SIF_low.merge_cubes(cube_NIRv_median_low)\n\nAdding two dummy variables to the datacube to match the number of oputput parameters of the optimization function.\n\ndataset_SIF_low = dataset_SIF_low.merge_cubes(\n    other=cube_SIF_original_median.rename_labels(dimension=\"bands\", target=[\"dummy_1\"])\n)\ndataset_SIF_low = dataset_SIF_low.merge_cubes(\n    other=cube_SIF_original_median.rename_labels(dimension=\"bands\", target=[\"dummy_2\"])\n)\n\n\n# dataset_SIF_low.execute_batch(outputfile=\"data/sif_predictors_cube_low.nc\")\n\nLet’s check the cube after resampling\n\ndataset_sif_low_local = xr.open_dataset(\"data/sif_predictors_cube_low.nc\")\nprint(dataset_sif_low_local)\n\n&lt;xarray.Dataset&gt; Size: 31kB\nDimensions:  (t: 1, x: 51, y: 30)\nCoordinates:\n  * t        (t) datetime64[ns] 8B 2023-06-29\n  * x        (x) float64 408B -6.871 -6.771 -6.671 ... -2.071 -1.971 -1.871\n  * y        (y) float64 240B 40.18 40.08 39.98 39.88 ... 37.48 37.38 37.28\nData variables:\n    crs      |S1 1B ...\n    SIF      (t, y, x) float32 6kB ...\n    LST      (t, y, x) float32 6kB ...\n    NIRv     (t, y, x) float32 6kB ...\n    dummy_1  (t, y, x) float32 6kB ...\n    dummy_2  (t, y, x) float32 6kB ...\nAttributes:\n    Conventions:  CF-1.9\n    institution:  Copernicus Data Space Ecosystem openEO API - 0.70.0a5.dev20...\n    description:  \n    title:        \n\n\n\nfig, axs = plt.subplots(nrows=3, figsize=(6, 15))\ndataset_sif_low_local[\"SIF\"].plot(ax=axs[0])\naxs[0].set_title(\"SIF\")\ndataset_sif_low_local[\"LST\"].plot(ax=axs[1])\naxs[1].set_title(\"LST\")\ndataset_sif_low_local[\"NIRv\"].plot(ax=axs[2])\naxs[2].set_title(\"NIRv\")\nplt.tight_layout()"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#sif-parameter-optimization-at-low-spatial-resolution",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#sif-parameter-optimization-at-low-spatial-resolution",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "SIF parameter optimization at low spatial resolution",
    "text": "SIF parameter optimization at low spatial resolution\nTo predict SIF we use the following formulation:\n\nDefinition 1 \\[SIF = f(V) \\cdot f(T)\\]\n\nwhere \\(f(V)\\) represents the vegetation module and \\(V\\) is a vegation index: \\[f(V) = b_2 \\cdot V^{b_1}\\]\n\\(f(T)\\) represents the temperature module where \\(T\\) is a variable that represent temperature stress (e.g. air temperature at 2 meters, or land surface temperature)\n\\[\nf(T) = e^{-\\frac{(T + b_5)^2}{2b_6^2}}\n\\]\nGiven the previous formulation we optimize the function using L-BFGS-B and a spatial moving window with 40 observations. The optimization function is defined in udf_parameters_optim_low_res.py.\nFirst we need to define the boundaries and start values for \\(b1\\), \\(b2\\), \\(b5\\) \\(b6\\) parameters:\n\n# the order for each variable follows: b1,b2,b3,b4,b5,b6\n\nparam_min = [0, 0.1, -310, 1]\n\nparam_ini = [1, 2, -295, 10]\n\nparam_max = [1.5, 5, -290, 50]\n\nTo apply the optimization function in the data cube we define an openEO User Define Function using:\n\nmy_udf = openeo.UDF.from_file(\n    \"src/udf/udf_parameters_optim_low_res.py\",\n    context={\n        \"param_ini\": param_ini,\n        \"param_min\": param_min,\n        \"param_max\": param_max,\n        \"min_obs\": 25,\n        \"window_size_lat\": 6,\n        \"window_size_lon\": 7,\n    },\n)\n\nNotice that the size of the moving window is set using window_size_lat and window_size_lon.\nThen we can apply our function to the data cube using:\n\nparameters_cube_low = dataset_SIF_low.apply_neighborhood(\n    process=my_udf,\n    size=[\n        {\"dimension\": \"x\", \"value\": 512, \"unit\": \"px\"},\n        {\"dimension\": \"y\", \"value\": 512, \"unit\": \"px\"},\n    ],\n    overlap=[\n        {\"dimension\": \"x\", \"value\": 0, \"unit\": \"px\"},\n        {\"dimension\": \"y\", \"value\": 0, \"unit\": \"px\"},\n    ],\n)\n\n# changing the name of the ouput\noutput_bands = [\"b1\", \"b2\", \"b5\", \"b6\"]\n\nparameters_cube_low_rename = parameters_cube_low.rename_labels(\"bands\", output_bands)\n\nand see the process graph:\n\nparameters_cube_low_rename\n\n\n    \n    \n        \n    \n    \n\n\nNow we will download the cube the optimized parameters to have a look and spatially upsample to match the Sentinel-3 cube at high resolution.\n\n\"\"\"\nparameters_cube_low_rename.execute_batch(outputfile=\"data/results_parameters_optim_low_resolution.tif\")\n\"\"\""
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#checking-parameter-optimization-results",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#checking-parameter-optimization-results",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Checking parameter optimization results",
    "text": "Checking parameter optimization results\n\nparameters_cube_local = rio.open_rasterio(\n    \"data/results_parameters_optim_low_resolution.tif\"\n)\nprint(parameters_cube_local)\n\n&lt;xarray.DataArray (band: 4, y: 30, x: 51)&gt; Size: 49kB\n[6120 values with dtype=float64]\nCoordinates:\n  * band         (band) int64 32B 1 2 3 4\n  * x            (x) float64 408B -6.871 -6.771 -6.671 ... -2.071 -1.971 -1.871\n  * y            (y) float64 240B 40.18 40.08 39.98 39.88 ... 37.48 37.38 37.28\n    spatial_ref  int64 8B 0\nAttributes:\n    institution:          Copernicus Data Space Ecosystem openEO API - 0.70.0...\n    PROCESSING_SOFTWARE:  0.70.0a5\n    AREA_OR_POINT:        Area\n    _FillValue:           nan\n    scale_factor:         1.0\n    add_offset:           0.0\n    long_name:            ('b1', 'b2', 'b5', 'b6')\n\n\nWarning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn't match SamplesPerPixel. Defining non-color channels as ExtraSamples.\n\n\n\n# plt.clf()\nfig, axs = plt.subplots(nrows=2, ncols=2, figsize=(8, 6))\naxs = axs.flatten()\ncounter = 0\nfor i in [1, 2, 5, 6]:\n    parameters_cube_local.isel(band=counter).plot(ax=axs[counter])\n    axs[counter].set_title(f\"b{i}\")\n    counter += 1\n\nplt.tight_layout()\n\n\n\n\n\n\n\n\n…."
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#resampling-olci-products-at-1-km",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#resampling-olci-products-at-1-km",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Resampling OLCI products at 1 km",
    "text": "Resampling OLCI products at 1 km\nOriginally the OLCI products are 300 meters resolution, as Sentinel-3 LST product is at 1 km (Table 1) we need to resample the NIRv cube:\n\ncube_NIRv_median_1 = cube_NIRv_median.resample_cube_spatial(\n    target=cube_LST_median, method=\"med\"\n)\n\nThen, we can concatenate all the variables in a single cube for prediction:\n\ncube_to_upscale = parameters_cube_high_median.merge_cubes(cube_LST_median)\n\ncube_to_upscale = cube_to_upscale.merge_cubes(cube_NIRv_median_1)\n\n\n# cube_to_upscale.execute_batch(outputfile=\"data/sif_predictors_cube_high.nc\")\n\nChecking that everything is in order with the code to upscale\n\ncube_to_upscale_local = xr.open_dataset(\"data/sif_predictors_cube_high.nc\")\n\nprint(cube_to_upscale_local)\n\n&lt;xarray.Dataset&gt; Size: 9MB\nDimensions:  (t: 1, x: 564, y: 336)\nCoordinates:\n  * t        (t) datetime64[ns] 8B 2023-06-23\n  * x        (x) float64 5kB -6.917 -6.908 -6.899 -6.89 ... -1.908 -1.899 -1.89\n  * y        (y) float64 3kB 40.22 40.22 40.21 40.2 ... 37.26 37.25 37.24 37.23\nData variables:\n    crs      |S1 1B ...\n    b1       (t, y, x) float64 2MB ...\n    b2       (t, y, x) float64 2MB ...\n    b5       (t, y, x) float64 2MB ...\n    b6       (t, y, x) float64 2MB ...\n    LST      (t, y, x) float64 2MB ...\n    NIRv     (t, y, x) float64 2MB ...\nAttributes:\n    Conventions:  CF-1.9\n    institution:  Copernicus Data Space Ecosystem openEO API - 0.70.0a5.dev20...\n    description:  \n    title:"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#downscaling-sif",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#downscaling-sif",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Downscaling SIF",
    "text": "Downscaling SIF\nTo downscale SIF we will use Definition 1. The code implementation of Definition 1 is available at udf_sif_downscaling.py. Then we can call the udf using:\n\nudf_sif_prediction = openeo.UDF.from_file(\n    \"src/udf/udf_sif_downscaling.py\",\n    context={\"window_size_lat\": 3, \"window_size_lon\": 3},\n)\n\nsif_downscaled = cube_to_upscale.apply_neighborhood(\n    udf_sif_prediction,\n    size=[\n        {\"dimension\": \"x\", \"value\": 512, \"unit\": \"px\"},\n        {\"dimension\": \"y\", \"value\": 512, \"unit\": \"px\"},\n    ],\n    overlap=[\n        {\"dimension\": \"x\", \"value\": 0, \"unit\": \"px\"},\n        {\"dimension\": \"y\", \"value\": 0, \"unit\": \"px\"},\n    ],\n)\n\nIt is not possible to reduce the number of bands using apply_neighborhood then we need to just select the first band:\n\n# removing bands that are not needed it\n\nsif_downscaled_renamed = sif_downscaled.rename_labels(\n    dimension=\"bands\", source=[\"b1\"], target=[\"SIF\"]\n)\n\nsif_downscaled_renamed = sif_downscaled_renamed.band(\"SIF\")\n\nNow we can run everthing and save the results\n\n\"\"\"\nsif_downscaled_renamed.execute_batch(\n    outputfile=\"data/openeo_sif_downscaled.tif\",\n    title=\"SIF_downscaling\",\n    description=\"Predicting SIF at high spatial resolution\"\n)\n\"\"\"\n\n'\\nsif_downscaled_renamed.execute_batch(\\n    outputfile=\"data/openeo_sif_downscaled.tif\",\\n    title=\"SIF_downscaling\",\\n    description=\"Predicting SIF at high spatial resolution\"\\n)\\n'"
  },
  {
    "objectID": "src/openEO_sif_downscaling_documented_and_plots.html#comparing-sif-products",
    "href": "src/openEO_sif_downscaling_documented_and_plots.html#comparing-sif-products",
    "title": "SIF Downscaling using OpenEO and the Copernicus Data Space Ecosystem (CDSE)",
    "section": "Comparing SIF products",
    "text": "Comparing SIF products\nComparing the original SIF product at 5 km with the Downscaled SIF at 1 km.\n\nsif_downscaled_local = rio.open_rasterio(\"data/openeo_sif_downscaled.tif\")\nprint(sif_downscaled_local)\n\n&lt;xarray.DataArray (band: 1, y: 336, x: 564)&gt; Size: 758kB\n[189504 values with dtype=float32]\nCoordinates:\n  * band         (band) int64 8B 1\n  * x            (x) float64 5kB -6.917 -6.908 -6.899 ... -1.908 -1.899 -1.89\n  * y            (y) float64 3kB 40.22 40.22 40.21 40.2 ... 37.25 37.24 37.23\n    spatial_ref  int64 8B 0\nAttributes:\n    institution:          Copernicus Data Space Ecosystem openEO API - 0.70.0...\n    PROCESSING_SOFTWARE:  0.70.0a5\n    AREA_OR_POINT:        Area\n    _FillValue:           nan\n    scale_factor:         1.0\n    add_offset:           0.0\n\n\n\nfig, axs = plt.subplots(nrows=2, figsize=(6, 10))\ncube_sif_local.plot(ax=axs[0])\naxs[0].set_title(\"SIF (Original)\")\nsif_downscaled_local.plot(ax=axs[1])\naxs[1].set_title(\"SIF (Downscaled)\")\n\nplt.tight_layout()\n\n\n\n\n\n\n\n\nTo validate the downscaling results let’s resample the SIF downscaled and compare it with the original product at 5 km.\n\nsif_downscaled_resampled = sif_downscaled_renamed.resample_cube_spatial(\n    target=cube_SIF_original_median,\n    method=\"med\",\n)\n\n\n# sif_downscaled_resampled.execute_batch(\"data/sif_downscaled_resampled.tif\")\n\n\nsif_downscaled_resampled_local = rio.open_rasterio(\"data/sif_downscaled_resampled.tif\")\nsif_downscaled_resampled_local\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;xarray.DataArray (band: 1, y: 30, x: 51)&gt; Size: 6kB\n[1530 values with dtype=float32]\nCoordinates:\n  * band         (band) int64 8B 1\n  * x            (x) float64 408B -6.871 -6.771 -6.671 ... -2.071 -1.971 -1.871\n  * y            (y) float64 240B 40.18 40.08 39.98 39.88 ... 37.48 37.38 37.28\n    spatial_ref  int64 8B 0\nAttributes:\n    institution:          Copernicus Data Space Ecosystem openEO API - 0.70.0...\n    PROCESSING_SOFTWARE:  0.70.0a5\n    AREA_OR_POINT:        Area\n    _FillValue:           nan\n    scale_factor:         1.0\n    add_offset:           0.0xarray.DataArrayband: 1y: 30x: 51...[1530 values with dtype=float32]Coordinates: (4)band(band)int641array([1])x(x)float64-6.871 -6.771 ... -1.971 -1.871array([-6.871387, -6.771387, -6.671387, -6.571387, -6.471387, -6.371387,\n       -6.271387, -6.171387, -6.071387, -5.971387, -5.871387, -5.771387,\n       -5.671387, -5.571387, -5.471387, -5.371387, -5.271387, -5.171387,\n       -5.071387, -4.971387, -4.871387, -4.771387, -4.671387, -4.571387,\n       -4.471387, -4.371387, -4.271387, -4.171387, -4.071387, -3.971387,\n       -3.871387, -3.771387, -3.671387, -3.571387, -3.471387, -3.371387,\n       -3.271387, -3.171387, -3.071387, -2.971387, -2.871387, -2.771387,\n       -2.671387, -2.571387, -2.471387, -2.371387, -2.271387, -2.171387,\n       -2.071387, -1.971387, -1.871387])y(y)float6440.18 40.08 39.98 ... 37.38 37.28array([40.179218, 40.079218, 39.979218, 39.879218, 39.779218, 39.679218,\n       39.579218, 39.479218, 39.379218, 39.279218, 39.179218, 39.079218,\n       38.979218, 38.879218, 38.779218, 38.679218, 38.579218, 38.479218,\n       38.379218, 38.279218, 38.179218, 38.079218, 37.979218, 37.879218,\n       37.779218, 37.679218, 37.579218, 37.479218, 37.379218, 37.279218])spatial_ref()int640crs_wkt :GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]]semi_major_axis :6378137.0semi_minor_axis :6356752.314245179inverse_flattening :298.257223563reference_ellipsoid_name :WGS 84longitude_of_prime_meridian :0.0prime_meridian_name :Greenwichgeographic_crs_name :WGS 84horizontal_datum_name :World Geodetic System 1984grid_mapping_name :latitude_longitudespatial_ref :GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\",6378137,298.257223563,AUTHORITY[\"EPSG\",\"7030\"]],AUTHORITY[\"EPSG\",\"6326\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.0174532925199433,AUTHORITY[\"EPSG\",\"9122\"]],AXIS[\"Latitude\",NORTH],AXIS[\"Longitude\",EAST],AUTHORITY[\"EPSG\",\"4326\"]]GeoTransform :-6.921387 0.1 0.0 40.229218 0.0 -0.1array(0)Indexes: (3)bandPandasIndexPandasIndex(Index([1], dtype='int64', name='band'))xPandasIndexPandasIndex(Index([          -6.871387,  -6.771387000000001,           -6.671387,\n       -6.5713870000000005,           -6.471387,           -6.371387,\n        -6.271387000000001,           -6.171387, -6.0713870000000005,\n                 -5.971387,           -5.871387,  -5.771387000000001,\n                 -5.671387, -5.5713870000000005,           -5.471387,\n                 -5.371387,  -5.271387000000001,           -5.171387,\n       -5.0713870000000005,           -4.971387,           -4.871387,\n        -4.771387000000001,           -4.671387,           -4.571387,\n                 -4.471387,           -4.371387,  -4.271387000000001,\n                 -4.171387,           -4.071387,           -3.971387,\n       -3.8713870000000004, -3.7713870000000003,           -3.671387,\n                 -3.571387,           -3.471387, -3.3713870000000004,\n       -3.2713870000000003,           -3.171387,           -3.071387,\n                 -2.971387, -2.8713870000000004,           -2.771387,\n                 -2.671387, -2.5713870000000005,           -2.471387,\n       -2.3713870000000004,           -2.271387,           -2.171387,\n       -2.0713869999999996,           -1.971387, -1.8713870000000004],\n      dtype='float64', name='x'))yPandasIndexPandasIndex(Index([40.179218000000006, 40.079218000000004,          39.979218,\n        39.87921800000001,  39.77921800000001, 39.679218000000006,\n       39.579218000000004,          39.479218,  39.37921800000001,\n        39.27921800000001, 39.179218000000006, 39.079218000000004,\n                38.979218,  38.87921800000001,  38.77921800000001,\n       38.679218000000006, 38.579218000000004,          38.479218,\n        38.37921800000001,  38.27921800000001, 38.179218000000006,\n       38.079218000000004,          37.979218,  37.87921800000001,\n        37.77921800000001, 37.679218000000006, 37.579218000000004,\n                37.479218,  37.37921800000001,  37.27921800000001],\n      dtype='float64', name='y'))Attributes: (6)institution :Copernicus Data Space Ecosystem openEO API - 0.70.0a5.dev20251125+3116PROCESSING_SOFTWARE :0.70.0a5AREA_OR_POINT :Area_FillValue :nanscale_factor :1.0add_offset :0.0\n\n\n\nfig, axs = plt.subplots(nrows=2, figsize=(6, 10))\ncube_sif_local.plot(ax=axs[0])\naxs[0].set_title(\"SIF (Original)\")\nsif_downscaled_resampled_local.plot(ax=axs[1])\naxs[1].set_title(\"SIF (Downscaled) resampled\")\n\nplt.tight_layout()\n\n\n\n\n\n\n\n\nNow let’s do \\(originalSIF - upscaledSIF\\)\n\nplt.clf()\ndifferences = cube_sif_local - sif_downscaled_resampled_local\ndifferences.plot()"
  }
]